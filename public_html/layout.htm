<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>renshuu layout</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="icon" type="image/ico" href="favicon.ico" />
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<link type="text/css" href="css/renshuu/jquery-ui-1.8.2.custom.css" rel="stylesheet" />
	<link type="text/css" href="css/main.css" rel="stylesheet" />
	<link type="text/css" href="css/autoSuggest.css" rel="stylesheet" />
	<link type="text/css" href="css/jquery.clockpick.1.2.7.css" rel="stylesheet" />
	
	  <style>
	  hr {
		display: block;
	}
  #infoPanel {
    float: left;
    margin-left: 10px;
  }
  #infoPanel div {
    margin-bottom: 5px;
  }
  </style>

	<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.1&amp;sensor=false&amp;language=ja"></script>

	<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.8.2.min.js"></script>
	
	<script type="text/javascript" src="js/jquery.timepicker.js"></script>
	<script type="text/javascript" src="js/jquery.clockpick.1.2.7.js"></script>
	
	<script type="text/javascript" src="js/jquery.inputnotes-0.6.js"></script>

	<script type="text/javascript" src="http://code.google.com/apis/gears/gears_init.js"></script>
	<script type="text/javascript" src="js/jstore/class.js"></script>
	<script type="text/javascript" src="js/jstore/browser.json.js"></script>
	<script type="text/javascript" src="js/jstore/jquery.jstore.js"></script>

	<script type="text/javascript" src="js/jquery.json-2.2.js"></script>
	<script type="text/javascript" src="js/jstorage.js"></script>

	<script type="text/javascript" src="js/jquery.curvycorners.js"></script>
	<script type="text/javascript" src="js/jquery.autoSuggest.js"></script>

	<script type="text/javascript" src="js/jquery.simplemodal-1.3.5.js"></script>
	
	<script type="text/javascript" src="js/renshuusurutoki.js"></script>

	<script type="text/javascript">

function updateMarkerStatus(str) {
	$('#location_form input[name=info]').val(str);
}

function updateMarkerPosition(latLng) {
	$('#location_form input[name=latitude]').val(latLng.lat());
	$('#location_form input[name=longitude]').val(latLng.lng());
}

function updateMarkerAddress(str) {
	$('#location_form input[name=address]').val(str);
}


		$(document).ready(function() {
			var hikone = new google.maps.LatLng(35.27655600992416, 136.25263971710206);
			$.reshuuSuruToki.init(
				$('#map').get(0), 
				$('#street').get(0),
				{
					center: hikone
				},
				{
					enableCloseButton: true,
					visible: false
				}
			);
			
			var latLng = $.reshuuSuruToki.map.getCenter();
			var marker = $.reshuuSuruToki.pins.createMarker(latLng, 'Point A', $.reshuuSuruToki.pins.gYellowIcon(), true);

			// Update current position info.
			updateMarkerPosition(latLng);
			$.reshuuSuruToki.data.geocodePosition(latLng);

			// Add dragging event listeners.
			google.maps.event.addListener(marker, 'dragstart', function() {
				marker.setOptions({icon: $.reshuuSuruToki.pins.gRedIcon()});
				updateMarkerAddress('Dragging...');
			});

			google.maps.event.addListener(marker, 'drag', function() {
				updateMarkerStatus('Dragging...');
				updateMarkerPosition(marker.getPosition());
			});

			google.maps.event.addListener(marker, 'dragend', function() {
				marker.setOptions({icon: $.reshuuSuruToki.pins.gYellowIcon()});
				updateMarkerStatus('Drag ended');
				$.reshuuSuruToki.data.geocodePosition(marker.getPosition());

				$.reshuuSuruToki.streetview.setPosition(marker.getPosition());
				$.reshuuSuruToki.streetview.setVisible(true);
			});

			
			

			$('#get_bounds').click(function() {
				$.reshuuSuruToki.getViewBounds();
				return false;
			});


			$('#list li a').click(function() {
				var attr = { type: $(this).parent().attr('') };
				$.get(ajaxpoint.get + 'location/' + $(this).attr('rev'), attr, function(data, status) {
					var len = data.response.length;
					for (var i = 0; i < len; ++i) {
						var item = data.response[i];
						var icon = 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + encodeURI(item.name.substr(0, 1)) + '|AA0000|FCFCFC&chof=png';
						console.log("icon: " + icon);
						
					}
				}, 'json');
				return false;
			});

			$('#new_location').click(function() {
				createLocation();
				return false;
			});
		});

		function createLocation() {
			$('<div></div>').html('Select a position from the map by clicking it.').dialog({
				title: "Create a new location",
				width: 400,
				height: 300,
				buttons: {
					"Ok": function() {
						var location = {
							latitude: lat,
							longitude: lng
						};
						$.post(ajaxpoint.set + 'location', location, function(data, status) {
							$(this).dialog("close");
						}, 'json');
					}
				}
			});
		}

		/**
		* @param target The select element as jQuery object
		* @param type String defining the type of the data to be fetched
		*/
		function loadOptions(target, type) {
			var append = '';
			$.get(ajaxpoint.get + type, {}, function(data, status) {
				var len = data.response.length;
				for (var i = 0; i < len; ++i) {
					var item = data.response[i];
					append += '<' + 'option value="' + item.id + '">' + item.title + '<' + '/option>';
				}
				target.children('option').replace(append);
			});
		}



		// http://code.google.com/apis/maps/documentation/javascript/reference.html#GeocoderStatus
		// http://marcgrabanski.com/articles/jquery-google-maps-tutorial-ajax-php-mysql

		function geoEncode() {
			var address = $("#add-point input[name=address]").val();
			geo.getLocations(address, function(result){
			if (result.Status.code == G_GEO_SUCCESS) {
				geocode = result.Placemark[0].Point.coordinates; savePoint(geocode);
			}
			else {
				var reason="Code"+result.Status.code;
				if (reasons[result.Status.code]) {
				reason = reasons[result.Status.code]
			}
			$("#add-point .error").html(reason).fadeIn();
				geocode = false;
			}
			});
		}


		// http://code.google.com/apis/maps/documentation/javascript/3.0/reference.html

		// http://code.drewwilson.com/entry/autosuggest-jquery-plugin
		var data = {
			items: [
				{value: "21", name: "Mick Jagger"},
				{value: "43", name: "Johnny Storm"},
				{value: "46", name: "Richard Hatch"},
				{value: "54", name: "Kelly Slater"},
				{value: "55", name: "Rudy Hamilton"},
				{value: "79", name: "Michael Jordan"}
			],
			arts: [
				{id: 1, name: 'Jikishinkage'},
				{id: 2, name: 'Ryukyu kobujutsu'},
				{id: 3, name: 'Yuishinkai'}
			]
		};


		$(document).ready(function() {
		
			// http://code.google.com/p/jquerytimepicker/
			$('input[name=starttime]').timePicker();
		
			// http://www.jnathanson.com/index.cfm?page=jquery/clockpick/ClockPick
			$('input[name=endtime]').clockpick();
		
			$("input[name=art]")
				.autoSuggest(
					data.arts, {
						startText: 'Type an art name',
						selectedItemProp: 'name',
						selectedValuesProp: 'id',
						searchObjProps: 'name',
						queryParam: '',
						selectionLimit: 2,
						//selectionClick: function(elem){ elem.fadeTo("slow", 0.33); },
						//selectionAdded: function(elem){ elem.fadeTo("slow", 0.33); },
						//selectionRemoved: function(elem){ elem.fadeTo("fast", 0, function(){ elem.remove(); }); },
						resultClick: function(data){
							for (var i in data.attributes) {
								console.log('resultClick - ' + i + ' = ' + data.attributes[i]);
							}
						}
					}
				)
				.change(
					function() {
						console.log('change - ' + $(this).attr('name') + ': ' + $(this).val());
					}
				);
			$("#training_form input[name=location]")
				.autoSuggest(
					data.items, {
						startText: 'Type a location name',
						selectedItemProp: 'name',
						searchObjProps: 'name'
					}
				)
				.change(
					function() {
						console.log($(this).attr('name') + ': ' + $(this).val());
					}
				);
			//$("input[name=art]").autoSuggest(ajaxpoint.get + $(this).attr('name'), {minChars: 2, matchCase: true});

			//$.jStore.load();

			var roundedCorners = {
				tl: { radius: 20 },
				tr: { radius: 20 },
				bl: { radius: 0 },
				br: { radius: 0 },
				antiAlias: true,
				autoPad: true,
				validTags: ["fieldset"]
			};
			$('fieldset').corner(roundedCorners);
/*
			$('input[name=duration]').after($('<span>', {name: 'durationslider'}));
			$('span[name=durationslider]').slider({
				range: 'min',
				max: 600,
				step: 5,
				value: 120,
				slide: function(event, ui) {
					$('input[name=duration]').val(ui.value);
				}
			});
			$('input[name=duration]').val($('span[name=durationslider]').slider('value'));
*/

			$('#new_location').click(function() {
				openModal('#location_form');
				return false;
			});
			
			
			// http://fredibach.ch/jquery-plugins/inputnotes.php
			$('input[name=title]').inputNotes({
				config: {
					containerTag: 'ul',
					noteTag: 'li'
				},
				minlength: {
					pattern: /^(.){0,5}$/i,
					type: 'info',
					text: 'Minimum password length is 6 characters.' 
				},


				requiredfield: {
					pattern: /(^(\s)+$)|(^$)/,
					type: 'warning',
					text: 'This field is required!' 
				},

				email: {
					pattern: /^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+$/,
					type: 'info',
					text: 'Yes, that\'s a valid email address!' 
				}
			});
			$('input[name=password]').inputNotes({
				minlength: {
					pattern: /^(.){0,5}$/i,
					type: 'info',
					text: 'Minimum password length is 6 characters.' 
				},
				characters: {
					pattern: /[^a-z0-9]/i,
					type: 'warning',
					text: 'Please only alphanumeric characters.' 
				},
				alphaandnum: {
					pattern: /(^[a-z]+$)|(^[0-9]+$)/i,
					type: 'warning',
					text: 'Please use both, letters and numbers.' 
				},
				bigandsmall: {
					pattern: /(^[a-z0-9]{2,}$)|(^[A-Z0-9]{2,}$)/,
					type: 'warning',
					text: 'Please use both, small and capitalized letters.' 
				}
			});


		});

		// http://www.ericmmartin.com/projects/simplemodal/
		var openModal = function(id) {
			$.modal($(id), {
				onOpen: function(dialog) {
					dialog.overlay.fadeIn('slow', function() {
						dialog.container.slideDown('slow', function() {
							dialog.data.fadeIn('slow');
						});
					});
				},
				onClose: function(dialog) {
					dialog.data.fadeOut('slow', function() {
						dialog.container.hide('slow', function() {
							dialog.overlay.slideUp('slow', function() {
								$.modal.close();
							});
						});
					});
				},
				closeClass: 'modal_close',
				modal: false
			});
			$(id).children('input[type=button][name=send]').click(function() {
			});
			
		};
/*
2010-07-27
Disturbed: Another way to die

28
Rammstein: ich tu dir weh
Bullet for my valentine: the last fight
*/
	</script>
</head>
<body>
	<div id="wrap">
		<div id="list">
			<p><a href="#" id="new_location">Create a new location</a></p>
		</div>
		<a title="jstore" href="test.x">Click Me</a>
	</div>

	<hr />

	<div id="map" class="ui-widget-content">Google Maps V3</div>
	<div id="street">Google Maps Street View</div>

	<div id="infoPanel">
		<b>Marker status:</b>
		<div id="markerStatus"><i>Click and drag the marker.</i></div>
		<b>Current position:</b>
		<div id="info"></div>
		<b>Closest matching address:</b>
		<div id="address"></div>
		<a href="#" id="get_bounds">get bounds</a>
	</div>
	
	<hr />
<div>
	<form id="location_form" action="/" method="post">
		<fieldset>
			<legend>Location</legend>
			<p><label><span>Title:</span><input type="text" name="title" /></label></p>
			<p><label><span>URI:</span><input type="text" name="uri" /></label></p>
			<p><label><span>Info:</span><input type="text" name="info" /></label></p>
			<p><label><span>Address(if any):</span><input type="text" name="address" /></label></p>
			<p><label><span>Auto fill:</span><input type="checkbox" name="addr_autofill" /> (address from map position)</label></p>
			<p><label><span>Latitude:</span><input type="text" name="latitude" disabled="disabled" /></label></p>
			<p><label><span>Longitude:</span><input type="text" name="longitude" disabled="disabled" /></label></p>
			<p><label><span>&nbsp;</span>
				<input type="button" name="send" value="Send location" class="button" />
				<input type="button" name="close" value="Close" class="modal_close" />
			</label></p>
		</fieldset>
	</form>
	<form id="person_form" action="/" method="post">
		<fieldset>
			<legend>Person</legend>
			<p><label><span>Name:</span><input type="text" name="title" /></label></p>
			<p><label><span>Art:</span><input type="text" name="art" /></label></p>
			<p><label><span>Contact:</span><input type="text" name="contact" /></label></p>
			<p><label><span>Info:</span><input type="text" name="info" /></label></p>
			<p><label><span>&nbsp;</span>
				<input type="button" name="send" value="Send person" />
				<input type="button" name="close" value="Close" class="modal_close" />
			</label></p>
		</fieldset>
	</form>
	<form id="art_form" action="/" method="post">
		<fieldset>
			<legend>Art</legend>
			<p><label><span>Name:</span><input type="text" name="title" /></label></p>
			<p><label><span>URI:</span><input type="text" name="uri" /></label></p>
			<p><label><span>&nbsp;</span>
				<input type="button" name="send" value="Send art" />
				<input type="button" name="close" value="Close" class="modal_close" />
			</label></p>
		</fieldset>
	</form>
	<form id="training_form" action="/" method="post">
		<fieldset>
			<legend>Training</legend>
			<p><label><span>Title:</span><input type="text" name="title" /></label></p>
			<p><label><span>Location:</span><input type="text" name="location" /></label></p>
			<p><label><span>Weekday:</span><select name="weekday"></select></label></p>
			<p><label><span>Occurance:</span><input type="text" name="occurance" /></label></p>
			<p><label><span>Start time:</span><input type="text" name="starttime" class="numeric" /></label></p>
			<p><label><span>End time:</span><input type="text" name="endtime" class="numeric" /></label></p>
			<p><label><span>Duration (minutes):</span><input type="text" name="duration" class="numeric" /></label></p>
			<p><label><span>Art:</span><select name="art"></select></label></p>
			<p><label><span>&nbsp;</span>
				<input type="button" name="send" value="Send training" />
				<input type="button" name="close" value="Close" class="modal_close" />
			</label></p>
		</fieldset>
	</form>
</div>

</body>
</html>
