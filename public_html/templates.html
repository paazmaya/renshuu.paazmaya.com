<!DOCTYPE html>
<html>
<head>
	<title>jsrender templates</title>
	<script src="js/jquery.js" type="text/javascript"></script>
	<script src="js/jsrender.js" type="text/javascript"></script>
	
	<script type="text/javascript">
		var renshuuMain = {};
		renshuuMain.locale = "en_GB";
		renshuuMain.lang = {"license":"License information","form":{"createnew":"Create new","clear":"Clear","modify":"Modify current","sending":"Sending data"},"list":{"removeitem":"Remove this item from the list"},"modal":{"savetolist":" Save to list","removefromlist":"Remove from list"},"suggest":{"art":"Type an art name","location":"Type a location name"},"validate":{"requiredfield":"This field is required!","minlength":"Minimum password length is 5 characters"}};
		renshuuMain.weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
	</script>
	
	<script id="unorderedTemplate" type="text/x-jquery-tmpl">
		<li>
			<label>
				<input type="checkbox" name="art_{{=id}}" /> {{=title}}
			</label>
		</li>
	</script>
	
	<script id="selectTemplate" type="text/x-jquery-tmpl">
		<option value="{{=id}}"> {{=title}}</option>
	</script>
	
	<script id="savedTemplate" type="text/x-jquery-tmpl">
		<tr id="saved-{{=training.id}}">
			<td>{{=training.art.title}}</td>
			<td>{{=weekDay}}</td>
			<td>{{=training.starttime}} - {{=training.endtime}}</td>
			<td><a href="#remove-{{=training.id}}" title="##tmpl_removeitem## - {{=training.weekday}}">
				<img src="img/sanscons/png/green/32x32/close.png" alt="##tmpl_removeitem##" />
			</a></td>
		</tr>
	</script>
		
	<script id="feedbackTemplate" type="text/x-jquery-tmpl">
		<h1 title="{{=message}}">{{=message}}</h1>
		{{#if title}}
			<p><strong>{{=title}}</strong></p>
		{{/if}}
		<p>
			<a href="#insert" data-key="insert" data-ref="0" data-action="clear" title="##tmpl_createnew## / ##tmpl_clear##">
				##tmpl_createnew## / ##tmpl_clear##
			</a>
		</p>
		<p>
			<a href="#update" data-key="update" data-ref="{{=id}}" data-action="keep" title="##tmpl_modify##">
				##tmpl_modify##
			</a>
		</p>
	</script>
	
	<script id="trainingTemplate" type="text/x-jquery-tmpl">
		<h2 class="summary" rel="art-{{=training.art.id}}">
			<a href="#training-{{=training.id}}" class="modal-close uid icon-close" title="{{=training.art.title}}">{{=training.art.title}}</a>
		</h2>
		{{#if training.weekday}}
			<p class="modal-time" rel="training-{{=training.id}}">{{=training.weekday}}
				<time class="dtstart" datetime="{{=training.starttime}}" title="{{=training.starttime}}">{{=training.starttime}}</time>
				-<time class="dtend" datetime="{{=training.endtime}}" title="{{=training.endtime}}">{{=training.endtime}}</time>
			</p>
		{{/if}}
		{{#if person.id}}
			<p class="modal-contact" rel="person-{{=person.id}}">{{=person.title}}
			{{#if person.contact}}
				 {{=person.contact}}
			{{/if}}
			</p>
		{{/if}}
		{{#if location.id}}
			<p class="modal-location" rel="location-{{=location.id}}">{{=location.title}}</p>
		{{/if}}
		<address class="geo">
			{{#if location.address}}
				{{=location.address}}
			{{/if}}
			<span>
				<abbr class="latitude" title="{{=location.latitude}}">{{=$ctx.deg2dms(location.latitude, true)}}</abbr>
				<abbr class="longitude" title="{{=location.longitude}}">{{=$ctx.deg2dms(location.longitude, false)}}</abbr>
			</span>
		</address>
		<p class="modal-tools">
			<a href="#savetolist-{{=training.id}}" title="##tmpl_savetolist##">##tmpl_savetolist##</a>
			<a href="#removefromlist-{{=training.id}}" title="##tmpl_removefromlist##" style="display:none;">##tmpl_removefromlist##</a>
		</p>
	</script>
	
</head>
<body>
	<div id="art"></div>
	<hr />
	<div id="location"></div>
	<hr />
	<div id="person"></div>
	<hr />
	<div id="training"></div>
	<hr />
	
	
	<script type="text/javascript">

		var artInsert = {id:20,title:"hoplaa",message:"New art created..."};

	
		var trainings = {
			location: {"id":"10","latitude":"35.657120","longitude":"139.706228","title":"Souhonbu Dojo","address":"日本, 東京都渋谷区渋谷３丁目４"},
			training: {"id":"3","art":{"id":"2","title":"琉球古武術保存振興会"},"weekday":"3","starttime":"15:00","endtime":"17:00"},
			person: {"id":null,"title":null,"contact":null}
		};

		$(document).ready(function() {
			$.views.registerHelpers({
			
				deg2dms: function (degfloat, isLatitude) {
					var letter = isLatitude ? 'NS' : 'EW';

					if (degfloat < 0) {
						degfloat = Math.abs(degfloat);
						letter = letter.substr(1, 1);
					}
					else {
						letter = letter.substr(0, 1);
					}

					//console.log('deg_to_dms. degfloat: ' + degfloat);

					var deg = Math.floor(degfloat);
					var minfloat = 60 * (degfloat - deg);
					//console.log('deg_to_dms. minfloat: ' + minfloat);
					var min = Math.floor(minfloat);
					//console.log('deg_to_dms. min: ' + min);
					var secfloat = 60 * (minfloat - min);
					//console.log('deg_to_dms. secfloat: ' + secfloat);
					secfloat = Math.round( secfloat );

					if (secfloat == 60) {
						min++;
						secfloat = 0;
					}
					if (min == 60) {
						deg++;
						min = 0;
					}
					//W 87°43'41"

					return (deg + '° ' + min + "' " + secfloat + '" ' + letter);
				}
			
			});
			
			artInsert.lang = renshuuMain.lang;
			var feedback = $('#feedbackTemplate').render(artInsert);
			$('#art').html(feedback);
			
			var training = $('#trainingTemplate').render(trainings);
			$('#training').html(training);
			
			//console.log('training: ' + training);
		});
	</script>

</body>
</html>


